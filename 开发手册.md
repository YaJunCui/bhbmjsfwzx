# 开发手册

## 目录
### [一、配置virtualenv虚拟环境](#chapter01)
### [二、用户角色](#chapter02)
### [开发中遇到的错误](#chapter_error)

<hr>

## <span id="chapter01">一、配置virtualenv虚拟环境</span>

1. 系统环境：   
   * 操作系统：win7 64bit
   * python 3.6.5

2. 安装命令：`pip install virtualenv`   
![virtualenv安装截图](https://github.com/YaJunCui/bhbmjsfwzx/blob/master/pictures/install_virtualenv.png?raw=true)

3. 新建虚拟环境：`virtualenv venv`  
![新建虚拟环境截图](https://github.com/YaJunCui/bhbmjsfwzx/blob/master/pictures/virtualenv_venv.png?raw=true)

    > 注：虚拟环境位于当前命令的目录下`D:\My Documents\桌面\bhbmjsfwzx\venv`，虚拟环境名称为`venv`。
4. 激活venv虚拟环境  
![激活虚拟环境截图](https://github.com/YaJunCui/bhbmjsfwzx/blob/master/pictures/venv_activate.png?raw=true)

5. 退出venv虚拟环境  
![退出虚拟环境截图](https://github.com/YaJunCui/bhbmjsfwzx/blob/master/pictures/venv_deactivate.png?raw=true)


## <span id="chapter02">二、用户角色</span>

1. 程序的权限

    |操作|位值|说明|
    |:--:|:--:|:--:|
    |查看信息|0b00000001（0x01）|可以查看他人提交的信息。|
    |写信息|0b00000010（0x02）|可以写信息。|
    |管理他人提交的信息|0b00000100（0x04）|管理他人提交的不当信息，或者用户提交的撤回申请。|
    |管理员权限|0b10000000（0x80）|管理网站|

2. 角色详情 

    |用户角色|权限|说明|
    |:--:|:--:|:--:|
    |匿名用户|0b00000000（0x00）|未登录的用户。|
    |普通用户|0b00000011（0x03）|信息已确认，具有读写权限。|
    |协管员|0b00000111（0x07）|增加驳回用户的申请。不能删除预约信息。|
    |管理员|0b10000111（0x87）|具有所有权限。|

## <span id="chapter_error">开发中遇到的错误</span>

1. ERROR 2013 (HY000): Lost connection to MySQL server的解决方法。

    在 my.cnf 里面的 [mysqld] 段增加一个启动参数：`skip-name-resolve`。
    所谓反向解析是这样的：
    mysql接收到连接请求后，获得的是客户端的ip，为了更好的匹配mysql.user里的权限记录（某些是用hostname定义的）。如果mysql服务器设置了dns服务器，并且客户端ip在dns上并没有相应的hostname，那么这个过程很慢，导致连接等待。添加skip-name-resolve以后就跳过着一个过程了。

2. 如果后台使用request.get_json()获取数据，则前台使用ajax传输数据时，需要使用 `contentType: 'application/json'`，指定服务器接收的数据格式；否则，只能使用 `request.form` 获取前台传来的数据。

